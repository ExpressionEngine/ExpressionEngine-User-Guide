<!--
    This source file is part of the open source project
    ExpressionEngine User Guide (https://github.com/ExpressionEngine/ExpressionEngine-User-Guide)

    @link      https://expressionengine.com/
    @copyright Copyright (c) 2003-2021, Packet Tide, LLC (https://packettide.com)
    @license   https://expressionengine.com/license Licensed under Apache License, Version 2.0
-->

# Multi-Factor Authentication

ExpressionEngine Pro adds extra level of protection that relies on one-time password generated by Multi-Factor Authentication app like Google Authenticator, Microsoft Authenticator or Authy.

## Enabling MFA in Control Panel

With ExpressionEngine Pro installed and being licensed, the members get Multi-Factor Authentication page in their profile in Control Panel. They can use it to turn this feature on and off and to set up their authentication application.

![MFA CP Setup](/_images/2fa-cp-setup.png)

## Control Panel protection

While setting up Multi-Factor Authentication (MFA) is optional for members, it can be set as required to access the Control Panel for certain member. 

![MFA CP Toggle](/_images/2fa-cp-toggle.png)

With this setting turned on, the members will be presented the dialog to enter one-time password when they log in to CP. They will not be able to access any of CP pages (except the "Multi-Factor Authentication" section of their profile) without authentication - they still will be able to access the site however.

If the member has not yet set up their multi-factor authentication, upon login to Control Panel they will be redirected to page in their profile where they can scan QR code using their MFA app and then enter the provided one-time password (OTP) to complete the setup.

## Enable MFA on front-end

Multi-Factor Authentication on front-end is handled using set of system dialogs. The dialogs can be triggered manually using the links provided by [`{exp:member:mfa_links}` tag](member/mfa.md) or automatically when user is accessing the template that is protected with MFA.

The dialogs are presented using `Multi-Factor Authentication Template` from System Message Templates. You can also use custom template from `system_messages` template group, it should be named `mfa_template`.

## Template protection

If you need to restrict certain areas of your site to only be accessible to members who have completed multi-factor authentication, you can turn `Require Multi-Factor Authentication` toggle on in template Access preferences.

![MFA Template Toggle](/_images/2fa-tmpl-toggle.png)

If logged out (guest) user is then trying to access the page that's using protected template, they will be presented error message indicating that login is required and Multi-Factor Authentication is required.

If the page is being accessed by the member who is logged in, but has not authenticated using their app, they are being presented with the dialog to set up or complete multi-factor authentication.

## Resetting MFA

In case when the device that was used to scan QR code for MFA is not available, it is possible to reset multi-factor authentication using the backup code that has been provided together with the QR code. 

## Disabling MFA

MFA can be disabled after the member has logged in and completed second-factor authentication. As additional protection measure, the password is being asked.
