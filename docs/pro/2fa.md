<!--
    This source file is part of the open source project
    ExpressionEngine User Guide (https://github.com/ExpressionEngine/ExpressionEngine-User-Guide)

    @link      https://expressionengine.com/
    @copyright Copyright (c) 2003-2021, Packet Tide, LLC (https://packettide.com)
    @license   https://expressionengine.com/license Licensed under Apache License, Version 2.0
-->

# Two-Factor Authentication

ExpressionEngine Pro adds extra level of protection that relies on one-time password generated by Two-Factor Authentication app like Google Authenticator, Microsoft Authenticator or Authy.

## Enabling 2FA in Control Panel

With ExpressionEngine Pro installed and being licensed, the members get Two-Factor Authentication page in their profile in Control Panel. They can use it to turn this feature on and off and to set up their authentication application.

![2FA CP Setup](/_images/2fa-cp-setup.png)

## Control Panel protection

While setting up Two-Factor Authentication (2FA) is optional for members, it can be set as required to access the Control Panel for certain member. 

![2FA CP Toggle](/_images/2fa-cp-toggle.png)

With this setting turned on, the members will be presented the dialog to enter one-time password when they log in to CP. They will not be able to access any of CP pages (except the "Two-Factor Authentication" section of their profile) without authentication - they still will be able to access the site however.

If the member has not yet set up their two-factor authentication, upon login to Control Panel they will be redirected to page in their profile where they can scan QR code using their 2FA app and then enter the provided one-time password (OTP) to complete the setup.

## Enable 2FA on front-end

Two-Factor Authentication on front-end is handled using set of system dialogs. The dialogs can be triggered manually using the links provided by [`{exp:member:two_fa_links}` tag](member/2fa.md) or automatically when user is accessing the template that is protected with 2FA.

The dialogs are presented using `Two-Factor Authentication Template` from System Message Templates. You can also use custom template from `system_messages` template group, it should be named `two-fa`.

## Template protection

If you need to restrict certain areas of your site to only be accessible to members who have completed two-factor authentication, you can turn `Require Two-Factor Authentication` toggle on in template Access preferences.

![2FA Template Toggle](/_images/2fa-tmpl-toggle.png)

If logged out (guest) user is then trying to access the page that's using protected template, they will be presented error message indicating that login is required and Two-Factor Authentication is required.

If the page is being accessed by the member who is logged in, but has not authenticated using their app, they are being presented with the dialog to set up or complete two-factor authentication.

## Resetting 2FA

In case when the device that was used to scan QR code for 2FA is not available, it is possible to reset two-factor authentication using the backup code that has been provided together with the QR code. 

## Disabling 2FA

2FA can be disabled after the member has logged in and completed second-factor authentication. As additional protection measure, the password is being asked.
